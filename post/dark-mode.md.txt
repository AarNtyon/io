1:HL["/_next/static/css/13eb794b8a62af15.css",{"as":"style"}]
0:[[["",{"children":["post",{"children":[["slug","dark-mode.md","d"],{"children":["__PAGE__?{\"slug\":\"dark-mode.md\"}",{}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/13eb794b8a62af15.css","precedence":"next"}]],["$L3",null]]]]
4:HL["/_next/static/css/4ac712d9614e435b.css",{"as":"style"}]
5:I{"id":"8920","chunks":["920:static/chunks/920-2fb459665447a51a.js","297:static/chunks/app/post/page-56c3a9ee63a6f83d.js"],"name":"","async":false}
6:"$Sreact.suspense"
7:I{"id":"7069","chunks":["920:static/chunks/920-2fb459665447a51a.js","185:static/chunks/app/layout-55cc4b2aa83c9cb5.js"],"name":"NoSSR","async":false}
8:I{"id":"5554","chunks":["920:static/chunks/920-2fb459665447a51a.js","185:static/chunks/app/layout-55cc4b2aa83c9cb5.js"],"name":"","async":false}
9:I{"id":"4463","chunks":["272:static/chunks/webpack-fd8259f661961224.js","667:static/chunks/2443530c-824e93370d7398c3.js","488:static/chunks/488-e1ddd61bb847c097.js"],"name":"","async":false}
a:I{"id":"1010","chunks":["272:static/chunks/webpack-fd8259f661961224.js","667:static/chunks/2443530c-824e93370d7398c3.js","488:static/chunks/488-e1ddd61bb847c097.js"],"name":"","async":false}
c:I{"id":"2263","chunks":["920:static/chunks/920-2fb459665447a51a.js","185:static/chunks/app/layout-55cc4b2aa83c9cb5.js"],"name":"","async":false}
2:[["$","html",null,{"lang":"en","children":["$","body",null,{"children":["$","div",null,{"id":"__next","children":["$","div",null,{"id":"app","className":"flex h-100% flex-col","children":[["$","header",null,{"className":"flex justify-between  w-68% h-66px m-auto items-center xs:w-100% p-l-80px p-r-80px xs:p-l-20px xs:p-r-20px shrink-0","children":[["$","$L5",null,{"className":"text-20px cursor-pointer font-bold font-mono dark:color-white hover:color-#1e90ff","href":"/","children":["$","span",null,{"children":"Rain's Blog"}]}],["$","nav",null,{"className":"flex items-center column-50px","children":[["$","nav",null,{"className":"text-right opacity-[0.6] text-[16px] dark:color-#e5e7eb flex","children":[["$","$L5",null,{"className":"mr-20px","href":"/post","children":[["$","span",null,{"className":"xs:hidden md:block","children":"文章"}],["$","i",null,{"className":"xs:block  md:hidden dark:color-#fff i-carbon-align-box-top-left"}]]}],["$","$L5",null,{"className":"mr-20px","href":"/tags","children":[["$","span",null,{"className":"xs:hidden md:block","children":"标签"}],["$","i",null,{"className":"xs:block  md:hidden dark:color-#fff i-carbon-bookmark-add"}]]}],["$","$L5",null,{"className":"mr-20px","href":"/about","children":[["$","span",null,{"className":"xs:hidden md:block","children":"关于"}],["$","i",null,{"className":"xs:block  md:hidden dark:color-#fff i-carbon-sprout"}]]}]]}],["$","$6",null,{"fallback":null,"children":["$","$L7",null,{"children":["$","$L8",null,{}]}]}]]}]]}],["$","main",null,{"className":"font-sans flex-auto","children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","post","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","post","children",["slug","dark-mode.md","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lb",null],"segment":"__PAGE__?{\"slug\":\"dark-mode.md\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4ac712d9614e435b.css","precedence":"next"}]]}],"segment":["slug","dark-mode.md","d"]},"styles":[]}],"segment":"post"},"styles":[]}]}],["$","footer",null,{"className":"dark:color-white text-center h-66px leading-[66px]","children":["© ",2023,", Rain | Powered by Next.js"]}],["$","$6",null,{"fallback":null,"children":["$","$L7",null,{"children":["$","$Lc",null,{}]}]}]]}]}]}]}],null]
3:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"Rain's Blog"}],["$","meta",null,{"name":"description","content":"Generated by create next app"}],null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
b:"$Ld"
d:["$","div",null,{"className":"prose w-60% m-auto m-b-50px xs:w-90% m-t-66px","children":[["$","div",null,{"className":"m-b-30px","children":["$","div",null,{"children":[["$","h1",null,{"children":"如何优雅的支持深色模式"}],["$","p",null,{"className":"flex justify-between","children":["$","span",null,{"className":"color-gray","children":["Author: Rain 写于 ","2022-01-13 10:28:25"]}]}]]}]}],["$","article",null,{"className":"prose","dangerouslySetInnerHTML":{"__html":"<h2>适配深色模式的例子</h2>\n<ul>\n<li><a href=\"https://vueuse.org/\">VueUse</a> 双选，手动切换</li>\n<li><a href=\"https://tailwindcss.com/\">Tailwind CSS</a> 三选，日，夜，跟随系统</li>\n</ul>\n<h2>CSR Only</h2>\n<p>如果只是客户端渲染的网页的话，事情还是很简单的。基本思路如下：</p>\n<ol>\n<li>\n<p>使用 jotai 定义一份用户偏好的全局设置，持久化到存储中</p>\n<pre class=\"pre-dark\" style=\"background:#fafafa\"><code><span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">atomWithStorage</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;jotai/utils&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">appearanceAtom</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">atomWithStorage</span><span style=\"color: #ABB2BF\">&lt;</span><span style=\"color: #98C379\">&quot;auto&quot;</span><span style=\"color: #ABB2BF\"> | </span><span style=\"color: #98C379\">&quot;light&quot;</span><span style=\"color: #ABB2BF\"> | </span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\">&gt;(</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #98C379\">&quot;use-dark&quot;</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #98C379\">&quot;auto&quot;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"></span></code></pre>\n</li>\n<li>\n<p>基于 jotai 的 atom 来实现自定义 hook <code>useDark</code>。\n综合用户和系统的选择来判断网页是否是深色，同时同步状态到 html 节点的 class 属性中。\n值得一提的是，当用户偏好和系统偏好保持一致时，我们需要更新用户偏好为 auto ，以让网页恢复跟随系统偏好。</p>\n<pre class=\"pre-dark\" style=\"background:#fafafa\"><code><span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">useAtom</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;jotai&quot;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">useEffect</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;react&quot;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">useMedia</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;react-use&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">export</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">function</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">useDark</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> [</span><span style=\"color: #E5C07B\">setting</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E5C07B\">setSetting</span><span style=\"color: #ABB2BF\">] </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">useAtom</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">appearanceAtom</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">isDark</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">useMedia</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;(prefers-color-scheme: dark)&quot;</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #61AFEF\">useEffect</span><span style=\"color: #ABB2BF\">(() </span><span style=\"color: #C678DD\">=&gt;</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">isDarkMode</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">===</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">||</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #E06C75\">isDark</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">&amp;&amp;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">!==</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;light&quot;</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #E06C75\">isDarkMode</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      </span><span style=\"color: #E5C07B\">document</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">documentElement</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">classList</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">toggle</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">true</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    } </span><span style=\"color: #C678DD\">else</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      </span><span style=\"color: #E5C07B\">document</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">documentElement</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">classList</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">toggle</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">false</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> ((</span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">===</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">&amp;&amp;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">isDark</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #56B6C2\">||</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">===</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;light&quot;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">&amp;&amp;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">!</span><span style=\"color: #E06C75\">isDark</span><span style=\"color: #ABB2BF\">)) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      </span><span style=\"color: #61AFEF\">setSetting</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;auto&quot;</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }, [</span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">isDark</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">setSetting</span><span style=\"color: #ABB2BF\">])</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">toggleDark</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> () </span><span style=\"color: #C678DD\">=&gt;</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">if</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">===</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;auto&quot;</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      </span><span style=\"color: #61AFEF\">setSetting</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">isDark</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">?</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;light&quot;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">:</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    } </span><span style=\"color: #C678DD\">else</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      </span><span style=\"color: #61AFEF\">setSetting</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">&quot;auto&quot;</span><span style=\"color: #ABB2BF\">)</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> [</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">===</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;dark&quot;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">||</span><span style=\"color: #ABB2BF\"> (</span><span style=\"color: #E06C75\">isDark</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">&amp;&amp;</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">setting</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">!==</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;light&quot;</span><span style=\"color: #ABB2BF\">),</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #E06C75\">toggleDark</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  ] </span><span style=\"color: #C678DD\">as</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">const</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span></code></pre>\n</li>\n<li>\n<p>应用自定义 hook 到主题切换的按钮和需要对接深色模式状态的组件上即可</p>\n</li>\n</ol>\n<p>可以看到，一切都很自然，客户端渲染的特性让我们不会看到还不完整的界面。\n在渲染组件时触发的 <code>useEffect</code> 能够正确同步 dark 信息到 html 的 class 标签上，界面不会有深浅模式切换的闪烁。</p>\n<p>💡 对于 Vue.js 的开发者，可以直接使用 vueuse 中包含的 <a href=\"https://vueuse.org/core/usedark/#usedark\">useDark</a> 函数。\n需要指出，这个函数返回的状态并非全局状态。</p>\n<h2>SSR</h2>\n<p>如果我们将上面的逻辑直接迁移到 Next.js 的话，就会出现闪烁的问题。</p>\n<p>原因在于 Next.js 返回的首屏网页是完整内容的 html ，浏览器已经可以直接加载出界面。\n然而在服务端，我们无法提前知道用户浏览器的外观偏好设置。\n当浏览器的偏好和返回的 html 设定不一致的时候，触发状态的同步就会导致浏览器界面闪烁。</p>\n<h3>如何解决</h3>\n<ol>\n<li>使用第三方库 next-themes 直接解决</li>\n<li>为网站返回的 html 实际内容前注入脚本，在页面加载之前执行来确保网页显示的颜色正确</li>\n</ol>\n<h3>支持 Next.js 13?</h3>\n<p>在 Next.js 13 版本中， app 目录下的组件默认为服务端组件。\nnext-themes 的 provider 或是自己的脚本，都需要为客户端组件。</p>\n<p>💡 参考 <a href=\"https://beta.nextjs.org/docs/rendering/server-and-client-components#rendering-third-party-context-providers-in-server-components\">Rendering third-party context providers in Server Components</a> 了解更多</p>\n<pre class=\"pre-dark\" style=\"background:#fafafa\"><code><span class=\"line\"><span style=\"color: #98C379\">&quot;use client&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">function</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">Provider</span><span style=\"color: #ABB2BF\">({ </span><span style=\"color: #E06C75; font-style: italic\">children</span><span style=\"color: #ABB2BF\"> }: { </span><span style=\"color: #E06C75\">children</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">React</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E5C07B\">ReactNode</span><span style=\"color: #ABB2BF\"> }) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> (</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &lt;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      &lt;</span><span style=\"color: #E06C75\">script</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #D19A66; font-style: italic\">id</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #98C379\">&quot;change-theme&quot;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        </span><span style=\"color: #D19A66; font-style: italic\">dangerouslySetInnerHTML</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #C678DD\">{</span><span style=\"color: #ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">          </span><span style=\"color: #E06C75\">__html</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #98C379\">`!function(){var e=window.matchMedia&amp;&amp;window.matchMedia(&quot;(prefers-color-scheme: dark)&quot;).matches,t=localStorage.getItem(&quot;use-dark&quot;)||&quot;auto&quot;;(&#39;&quot;dark&quot;&#39;===t||e&amp;&amp;&#39;&quot;light&quot;&#39;!==t)&amp;&amp;document.documentElement.classList.toggle(&quot;dark&quot;,!0)}()`</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">        }</span><span style=\"color: #C678DD\">}</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      &gt;&lt;/</span><span style=\"color: #E06C75\">script</span><span style=\"color: #ABB2BF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      </span><span style=\"color: #C678DD\">{</span><span style=\"color: #E06C75\">children</span><span style=\"color: #C678DD\">}</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &lt;/&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  )</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">export</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">default</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">Provider</span></span>\n<span class=\"line\"></span></code></pre>\n<p>顺便一提， jotai 在将字符串存储到 storage 里面时，会加上 “”。\n因此，上面的脚本中，当我们手动取值时，实际取出的内容需要补上它。</p>\n<p>此外，由于脚本会修改 html 标签上的 class 属性，导致客户端的网页和浏览器的网页内容不一致。\n我们需要为 html 标签加上 <code>suppressHydrationWarning</code> 属性来告诉 Next.js 在激活时忽略它。</p>\n<h2>一点点动画</h2>\n<p>首先我们可以给整个网站在深浅色切换时的颜色过渡加上一点点 transition。<code>transition-colors duration-500</code></p>\n<p>然后就是切换主题的按钮，深浅色图标切换时加上一点旋转的动画。</p>\n<pre class=\"pre-dark\" style=\"background:#fafafa\"><code><span class=\"line\"><span style=\"color: #98C379\">&quot;use client&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">useDark</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">&quot;@/app/hooks/useDark&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">AppearanceSwitch</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> () </span><span style=\"color: #C678DD\">=&gt;</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> [, </span><span style=\"color: #E5C07B\">toggleDark</span><span style=\"color: #ABB2BF\">] </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">useDark</span><span style=\"color: #ABB2BF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> (</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &lt;</span><span style=\"color: #E06C75\">button</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66; font-style: italic\">onClick</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #C678DD\">{</span><span style=\"color: #E06C75\">toggleDark</span><span style=\"color: #C678DD\">}</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66; font-style: italic\">className</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #98C379\">&quot;text-2xl flex&quot;</span><span style=\"color: #ABB2BF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      &lt;</span><span style=\"color: #E06C75\">div</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66; font-style: italic\">className</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #98C379\">&quot;i-carbon-sun rotate-0 scale-100 transition-transform duration-500 dark:-rotate-90 dark:scale-0&quot;</span><span style=\"color: #ABB2BF\"> /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      &lt;</span><span style=\"color: #E06C75\">div</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66; font-style: italic\">className</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #98C379\">&quot;i-carbon-moon absolute rotate-90 scale-0 transition-transform duration-500 dark:rotate-0 dark:scale-100&quot;</span><span style=\"color: #ABB2BF\"> /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">      &lt;</span><span style=\"color: #E06C75\">span</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #D19A66; font-style: italic\">className</span><span style=\"color: #56B6C2\">=</span><span style=\"color: #98C379\">&quot;sr-only&quot;</span><span style=\"color: #ABB2BF\">&gt;Toggle theme&lt;/</span><span style=\"color: #E06C75\">span</span><span style=\"color: #ABB2BF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    &lt;/</span><span style=\"color: #E06C75\">button</span><span style=\"color: #ABB2BF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  )</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C678DD\">export</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">default</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E06C75\">AppearanceSwitch</span></span>\n<span class=\"line\"></span></code></pre>\n<h2>相关链接</h2>\n<ol>\n<li><a href=\"https://blog.skk.moe/post/hello-darkmode-my-old-friend\">你好黑暗，我的老朋友 —— 为网站添加用户友好的深色模式支持</a></li>\n<li><a href=\"https://blog.skk.moe/post/use-nextjs-and-hexo-to-rebuild-my-blog/#Wei-Wang-Zhan-Tian-Jia-Yong-Hu-You-Hao-De-Shen-Se-Mo-Shi-Zhi-Chi\">为网站添加用户友好的深色模式支持</a></li>\n<li>https://github.com/pacocoursey/next-themes</li>\n<li>next-themes 关于 nextjs 13 支持的讨论 https://github.com/pacocoursey/next-themes/issues/152</li>\n<li><a href=\"https://github.com/pacocoursey/next-themes/issues/152#issuecomment-1364280564\">使用 suppressHydrationWarning 来处理报错</a></li>\n</ol>\n"}}]]}]
